version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Build
    task:
      jobs:
        - name: Build
          commands:
            - checkout
            - 'docker pull --quiet cloudfoundry/cnb:cflinuxfs3'
            - >-
              docker run --rm -it -v ${PWD}:/app -w /app -v /tmp/layers:/layers
              -v /tmp/cache:/cache alpine sh -c 'chown -R "1000:1000" "/layers"
              && chown -R "1000:1000" "/cache" && chown -R "1000:1000" "/app"'
            - >-
              docker run --rm -it -v ${PWD}:/app -w /app -v /tmp/layers:/layers
              -v /tmp/cache:/cache cloudfoundry/cnb:cflinuxfs3
              /lifecycle/detector -app=/app -group=/layers/group.toml
              -plan=/layers/plan.toml
